{% extends "base.html" %}
{% load staticfiles %}

{% block breadcrumbs %}
	<li>Transaction</li>
	{% if action == "edit" %}
		<li>Edit GroupForm</li>
	{% else %}
		<li>Create GroupForm</li>
	{% endif %}
{% endblock %}

{% block content %}
	<style>
		.form-horizontal .control-label{text-align: left}
		.page-header{margin: 0 0 20px}
		.page-header h1{margin-left: 0px}
		.form-add-user input{width: 100%}
		.form-add-user textarea{padding:5px; height: 114px; width: 100%}
{#		.form-add-user .red{color: red!important}#}
		.form-add-user .red:hover {text-decoration: blink}
		.form-add-user ul.errorlist{
			list-style: none;
			padding-left: 10px;
			background-color: pink;
			border: thin solid red;
			margin: 5px 15px 10px 15px;
		}
		.form-add-user select{width: 50%!important}
	</style>
	<div class="row">
		<form class="form-horizontal form-add-user" method="post"  action="{{ request.path }}"  enctype="multipart/form-data">
			<div class="col-xs-12">
				{% if action == "edit" %}
					<div class="page-header">
						<h1>Edit GroupForm</h1>
					</div>
				{% else %}
					<div class="page-header">
						<h1>Create GroupForm</h1>
					</div>
				{% endif %}
				<div class="col-xs-6">
					{% csrf_token %}
					<div class="form-group">
						{{ form.name.errors }}
						<label class="col-sm-3 control-label no-padding-right">Name <span class="red">*</span>:</label>
						<div class="col-sm-9">
							{{ form.name }}
						</div>
					</div>
					<div class="form-group">
						{{ form.description.errors }}
						<label class="col-sm-3 control-label no-padding-right">Description:</label>
						<div class="col-sm-9">
							{{ form.description }}
						</div>
					</div>
					<div class="form-group">
						{{ form.html.errors }}
						<label class="col-sm-3 control-label no-padding-right">Html:</label>
						<div class="col-sm-9">
							{{ form.html }}
						</div>
					</div>
					<div class="form-group">
						{{ form.icon.errors }}
						<label class="col-sm-3 control-label no-padding-right">Icon:</label>
						<div class="col-sm-9">
							{% if icon_path %}
								<div class="icon-image">
									<span class="profile-picture">
										<img style="width: 150px" id="avatar" class="editable img-responsive editable-click editable-empty" alt="Icon" src="{{ MEDIA_URL }}{{ icon_path }}">
									</span>
									<a href="#" class="red remove_image" title="remove image">
										<i class="icon-trash bigger-130"></i>
									</a>
								</div>
							{% endif %}
							<input style="margin-top: 10px" id="id_icon" name="icon" placeholder="File path" type="file">
						</div>
					</div>
				</div>
				<div class="clearfix form-actions" style="float:left; width: 100%">
					<div class="">
						<button class="btn btn-info button-submit-field">
							<i class="icon-ok bigger-110"></i>
							Submit
						</button>

						&nbsp; &nbsp; &nbsp;
						<button class="btn" type="reset">
							<i class="icon-undo bigger-110"></i>
							Reset
						</button>

						{% if action == "edit" %}
							&nbsp; &nbsp; &nbsp;
							<button id="delete-groupform-{{ groupform_id }}" class="btn btn-danger button-delete-groupform">
								<i class="icon-remove bigger-110"></i>
								Delete
							</button>
						{% endif %}

						&nbsp; &nbsp; &nbsp;
						<span class="loading-span" style="font-size: 14px; display: none"><img width="30px" src="{% static 'bootstrap/images/loading.gif' %}"> Please wait...</span>
					</div>
				</div>
			</div>
		</form>
	</div>

{% endblock %}

{% block extra_script %}
	<script>
		$(".button-submit-field").click(function(){
			var formSubmit = $(this).parents("form");
			$(this).attr("disabled", true);
			$(".loading-span").show();
			formSubmit.submit();
			return false;
		});
	</script>
	<script>
		$(".remove_image").click(function(){
			$.ajax({
				url: "{{ request.path }}",
				type: "DELETE",
				beforeSend: function(xhr, settings){
					if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
						xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
					}
				},
				success: function(){
					if (confirm("Do you want to delete this icon?")){
						$(".icon-image").fadeOut(300, function() {
							$(".icon-image").remove();
						});
					}
				},
				error: function(){
					alert("Can not delete this icon. Please try again");
				}
			});
			return false;
		})
	</script>
	{% if action == "edit" %}
		<script>
		$("body").on("click", ".button-delete-groupform", function(){
			if (confirm("Do you want to delete this GroupForm?")) {
				var field_id = ($(this).attr("id")).split("-")[2];
				var me = $(this);
				$(".loading-span").show();
				$(this).attr("disabled", true);
				$.ajax({
					url: "/transaction/group_form_delete/" + field_id,
					type: "DELETE",
					beforeSend: function (xhr, settings) {
						if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
							xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
						}
					},
					success: function (data) {
						window.location.href = "/transaction/list_group_form";
					},
					error: function (request, error) {
						alert("ERROR: You can not delete this GroupForm");
						$(".loading-span").hide();
						me.removeAttr('disabled');
					},
				});
			}
			return false;
		});
	</script>
	{% endif %}
{% endblock %}